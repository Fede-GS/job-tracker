# ðŸš€ FinixJob â€” Deployment Guide (Render.com)

## Architecture

```
[Browser] â”€â”€â–º https://finixjob.onrender.com          (React SPA â€” Render Static Site)
               â”‚  API calls
               â””â”€â”€â–º https://finixjob-api.onrender.com  (Flask + Gunicorn â€” Render Web Service)
                         â”‚
                         â”œâ”€â”€ /data/instance/tracker.db   (SQLite â€” Render Persistent Disk)
                         â””â”€â”€ /data/uploads/              (File uploads â€” Render Persistent Disk)
```

---

## Prerequisites

- [GitHub](https://github.com) account
- [Render.com](https://render.com) account (free)
- Your Gemini API key (from [Google AI Studio](https://aistudio.google.com))

---

## Step 1 â€” Push to GitHub

```bash
# From the project root
git init                          # if not already a git repo
git add .
git commit -m "feat: production deployment setup"
git remote add origin https://github.com/YOUR_USERNAME/finixjob.git
git push -u origin main
```

---

## Step 2 â€” Deploy on Render (Blueprint â€” Automatic)

1. Go to [render.com/dashboard](https://dashboard.render.com)
2. Click **"New +"** â†’ **"Blueprint"**
3. Connect your GitHub repo
4. Render will detect `render.yaml` and create **2 services** automatically:
   - `finixjob-api` â€” Flask backend
   - `finixjob` â€” React frontend

> âš ï¸ **Important**: After the Blueprint is created, you must manually add the secret
> environment variables (see Step 3).

---

## Step 3 â€” Set Secret Environment Variables

### Backend service (`finixjob-api`) â†’ Environment tab:

| Variable | Value |
|----------|-------|
| `GEMINI_API_KEY` | Your Google Gemini API key |
| `BLACKBOX_HISTORY_API_KEY` | Your Blackbox API key (optional) |
| `SECRET_KEY` | Auto-generated by Render âœ… |
| `JWT_SECRET_KEY` | Auto-generated by Render âœ… |
| `OPEN_REGISTRATION` | `false` (invite-only) |
| `ALLOWED_ORIGINS` | `https://finixjob.onrender.com` |
| `RENDER_DATA_DIR` | `/data` |

### Frontend service (`finixjob`) â†’ Environment tab:

| Variable | Value |
|----------|-------|
| `VITE_API_BASE_URL` | `https://finixjob-api.onrender.com/api` |

> After setting env vars, click **"Manual Deploy"** â†’ **"Deploy latest commit"** to rebuild.

---

## Step 4 â€” Verify Deployment

1. Open `https://finixjob-api.onrender.com/api/auth/me` â†’ should return `401` (backend is up)
2. Open `https://finixjob.onrender.com` â†’ should show the login page

---

## Step 5 â€” Create Your Admin Account

1. Go to `https://finixjob.onrender.com/register`
2. Register with your email â€” **the first user automatically becomes admin**
3. Log in and go to **Settings â†’ Admin** to manage invited users

---

## Step 6 â€” Invite Selected Users

Since `OPEN_REGISTRATION=false`, only invited emails can register.

### Via the Admin Panel (UI):
1. Log in as admin
2. Go to **Settings â†’ Admin Panel**
3. Add the email addresses of users you want to invite
4. Send them the registration link: `https://finixjob.onrender.com/register`

### Via API (curl):
```bash
# First, get your JWT token by logging in
TOKEN="your-jwt-token-here"

# Add an invited email
curl -X POST https://finixjob-api.onrender.com/api/admin/invited-emails \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com"}'
```

---

## Custom Domain (Optional)

1. In Render dashboard â†’ your service â†’ **Settings** â†’ **Custom Domains**
2. Add your domain (e.g. `app.finixjob.com`)
3. Update `ALLOWED_ORIGINS` on the backend to include your custom domain
4. Update `VITE_API_BASE_URL` on the frontend if you also use a custom domain for the API

---

## Free Tier Limitations

| Feature | Free Tier |
|---------|-----------|
| Backend spin-up | ~30s cold start after 15min inactivity |
| Frontend | Always fast (static CDN) |
| Persistent Disk | **Not available on free tier** â€” upgrade to Starter ($7/mo) |
| Bandwidth | 100 GB/month |

> âš ï¸ **Persistent Disk** is required for SQLite + file uploads to survive restarts.
> Without it, data is lost on every deploy/restart.
> **Recommended**: Upgrade the backend service to the **Starter plan ($7/month)** to enable the disk.

---

## Local Development (unchanged)

```bash
# Backend
cd backend
pip install -r requirements.txt
python run.py

# Frontend (separate terminal)
cd frontend
npm install
npm run dev
```

The frontend dev server proxies `/api` â†’ `http://localhost:5000` automatically.

---

## Troubleshooting

### CORS errors in browser
- Check `ALLOWED_ORIGINS` on the backend includes the exact frontend URL (no trailing slash)
- Redeploy the backend after changing env vars

### 500 errors on backend
- Check Render logs: Dashboard â†’ `finixjob-api` â†’ **Logs**
- Ensure `GEMINI_API_KEY` is set correctly

### Data lost after redeploy
- You need the **Persistent Disk** (Starter plan) â€” see Free Tier Limitations above

### React routes return 404
- The `_redirects` file in `frontend/public/` handles this automatically on Render Static Sites
